{% for name, vnet in vnets.items() %}
{% if vnet['vnet_network']['route_tables'] is defined %}
{% for route_table in vnet['vnet_network']['route_tables'] %}

module "{{ name }}-{{route_table.name}}-rt" {
    source                              = "{{ module_dir }}/route_table"
    providers                           = { aws = "aws.{{ vnet['vnet_network']['region'] }}"}
    vpc_id                              = "${module.{{ name }}-vpc.vpc_id}"
    name                                = "{{ name }}-{{route_table.name}}-rt"
    {% for route in route_table['routes'] %}
    prefix                              = "{{route.prefix}}"
    {% if route['next_hop_type'] == 'VGW' %}
    vgw_next_hop                        = "${module.{{ name }}-vgw.vgw_id}"
    create_route_to_vgw                 = "true"
    {% endif %}
    {% if route['next_hop_type'] == 'IGW' %}
    igw_next_hop                        = "${module.{{ name }}-igw.igw_id}"
    create_route_to_igw                 = "true" 
    {% endif %}
    {% if route['next_hop_type'] == 'TGW' %}
    {% set tgw = route['next_hop_id'].split('|') %}
    {% if tgw[0] == 'vnet' %}
    tgw_next_hop                        = "${module.{{ tgw[1] }}-aws_transit_gw.aws_ec2_transit_gateway_id}"
    {% endif %}
    create_route_to_tgw                 = "true" 
    {% endif %}  
    {% endfor %}  
}

{% endfor %}
{% endif %}
{% endfor %}
