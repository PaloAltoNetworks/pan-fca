{% for name, vnet in vnets.items() %}
{% if vnet['spoke_vpcs'] is defined %}

{% for vpc in vnet['spoke_vpcs'] %}

module "{{ name }}-vpc-{{ vpc.name }}" {
    create_vpc                          = true
    source                              = "{{ module_dir }}/aws/vpc"
    providers                           = {
                                            aws = "aws.{{ vpc['region'] }}"
    }
    name                                = "{{ name }}-vpc-{{ vpc.name }}"
    cidr                                = "{{ vpc['cidr'] }}"
    assign_generated_ipv6_cidr_block    = false
    instance_tenancy                    = default
}

{% endfor %}

{% endif %}
{% endfor %}