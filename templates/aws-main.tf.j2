provider "aws" {
  region = "{{ location }}"
  version = "{{ cloud_provider_tf_version}}"  
}

{% for name, vnet in vnets.items() %}
{% if vnet['vnet_network'] is defined %}
{% for vpc in vnet['vnet_network'] %}
provider "aws" {
  alias  = "{{ vpc['region'] }}"
  region = "{{ vpc['region'] }}"
}
{% endfor %}
{% endif %}
{% endfor %}


{% include 'aws-spoke-vpc.tf.j2' %}
{% include 'aws-spoke-subnet.tf.j2' %}
{% include 'aws-transitvpc-spoke-vgw.tf.j2' %}
{% include 'aws-transitvpc-spoke-routetable.tf.j2' %}